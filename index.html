<!DOCTYPE html>

<html>

<head>
	<title>Visualize Uncertainty Sketches</title>
	<script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
	<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans">
	<meta name="viewport" content="width=device-width">
</head>

<!-- Stylesheet -->
<style>

html, body {
	top:0;
	left:0;
	padding:0;
	width:100%;
	margin:0;
	font-family: 'Open Sans', sans-serif;
}
header {
	background-color:white;
	width:80%;
	height:auto;
	padding: 5%;
}

site-logo {
	font-size:0.8em;
	border:0.3em solid #EB2E2F;
	padding:1%;
	color: black;
	letter-spacing:0.2em;
	text-transform:uppercase;
	font-weight:600;
	vertical-align:bottom;
}

nav {
	color: #1A1A1A;
	float:right;
	font-size:2em;
	margin-top:-1%;
}

selected-variable h1, boolean-lightbox h1 {
	font-size:1em;
	text-transform:uppercase;
	letter-spacing:0.05em;
	color:grey;
	line-height:1em;
}
selected-variable h2{
	font-size:2em;
	padding:0;
	margin:0;
	font-weight:600;
	width:80%;
	line-height:1em;
	transition: 0.5s ease;
}

h5 {
	font-size:1em;
	font-weight:100;
	padding-bottom:0.1%;
	display:inline;
	color:white;
	border-bottom: 0.05em dotted white;
	vertical-align:top;
}

#default-message {
	color:white;
	font-weight:100;
	letter-spacing:0.02em;
}

#output-count {
	position:absolute;
	color:white;
	text-decoration:none;
	float:right;
	bottom:10%;
	right:0;
	cursor:pointer;
	transition:0.25s ease-in-out;
}

#output-count:hover {
	text-decoration:underline;

}

output-screen h1, p {
	padding-left:10%;
	padding-right:10%;
}

output-screen h1 {
	padding-top:10%;
	font-size:1.5em;
}

boolean-lightbox .variable-value {
	display:none;
}

/*img-holder*/
img-holder {
	position:relative;
	display:inline-block;
	overflow:hidden;
	width:12.5%;
	height:auto;
	opacity:1;
}
img-holder img {
	position:relative;
	display:block;
	z-index:0;
	width:120%;
	height:100%;
	cursor:pointer;
}
img-holder div {
	display:block;
	position:absolute;
	top: 0;
  	bottom: 0;
  	left: 0;
  	right: 0;
	width:100%;
	height:100%;
	background-color:black;
	z-index:1;
	transition:0.25s ease-in-out;
}
img-holder p {
	text-align:center;
	color:white;
}

/*image captions*/
.overlay {
	position:absolute;
	top: 0;
  	bottom: 0;
  	left: 0;
  	right: 0;
	width:100%;
	height:100%;
	opacity:0;
	background-color:black;
	transition:0.25s ease-in-out;
	line-height:1em;
}
.overlay p {
	text-align:center;
	color:white;
	font-size:0.8em;
	font-weight:400;
	letter-spacing:0.05em;

}
img-holder:hover .overlay {
	opacity:1;
	display:inline-block;
}


/* The switch - the box around the slider 
.switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
}

/* Hide default HTML checkbox */
.switch input {display:none;}

/* The slider */
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  -webkit-transition: .4s;
  transition: .4s;
}

.slider:before {
  position: absolute;
  content: "";
  height: 26px;
  width: 26px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  -webkit-transition: .4s;
  transition: .4s;
}

input:checked + .slider {
  background-color: #2196F3;
}

input:focus + .slider {
  box-shadow: 0 0 1px #2196F3;
}

input:checked + .slider:before {
  -webkit-transform: translateX(26px);
  -ms-transform: translateX(26px);
  transform: translateX(26px);
}

/* Rounded sliders */
.slider.round {
  border-radius: 34px;
}

.slider.round:before {
  border-radius: 50%;
}

@media screen and (max-width:900px) {
	header {
		padding: 12.5% 5%;
	}
	#output-count {
		position:relative;
		padding-top:5%;
		bottom:0;
	}
	output-screen h1, p {
		padding-left:5%;
		padding-right:5%;
	}
	output-screen h1 {
		margin-top:10vh;
		padding-top:0%;
	}
	selected-variable {
		padding-left:5%;
	}
	site-logo {
		padding:5%;
	}
	img-holder {
		width:;
	}
}

</style>

<!-- Body Markup -->
<body>

	<bg-overlay></bg-overlay>
	<lightbox-slider></lightbox-slider>

	<header>
		<site-logo>Uncertainty</site-logo>
		<nav>&#9776;</nav>
	</header>

	<slider-lightbox>
		<close-cancel>X</close-cancel>
		<selected-variable>
			<h1 class="variable-name"></h1>
			<h2 class="variable-value"></h1>
		</selected-variable>
		<slider-holder>
			<gradient-slider>
				<mobile-instructions>
					<instructions-section>
					</instructions-section>
				</mobile-instructions>
			</gradient-slider>
		</slider-holder>
		<save-close>Save</save-close>
	</slider-lightbox>

	<checkbox-lightbox>
		<close-cancel>X</close-cancel>
		<selected-variable>
			<h1 class="variable-name"></h1>
			<h2 class="variable-value"></h1>
		</selected-variable>
		<checkbox-holder>
			  <input type="radio" name="ordinal" value="Extremely Strong"> Extremely Strong<br>
			  <input type="radio" name="ordinal" value="Somewhat Strong"> Somewhat Strong<br>
			  <input type="radio" name="ordinal" value="None"> None
		</checkbox-holder>
		<save-close>Save</save-close>
	</checkbox-lightbox>

	<boolean-lightbox>
		<close-cancel>X</close-cancel>
		<div id="re">
			<h1 class="variable-name"></h1>
			<h2 class="variable-value"></h1>
			  <input type="radio" name="re" value="Extremely Strong"> Extremely Strong<br>
			  <input type="radio" name="re" value="Somewhat Strong"> Somewhat Strong<br>
			  <input type="radio" name="re" value="None"> None
		</div>
		<div id="sp">
			<h1 class="variable-name"></h1>
			<h2 class="variable-value"></h1>
			  <input type="radio" name="sp" value="Extremely Strong"> Extremely Strong<br>
			  <input type="radio" name="sp" value="Somewhat Strong"> Somewhat Strong<br>
			  <input type="radio" name="sp" value="None"> None
		</div>
		<div id="ki">
			<h1 class="variable-name"></h1>
			<h2 class="variable-value"></h1>
			<label class="switch">
			  <input type="checkbox" name="ki" value="Present">
			  <span class="slider round"></span>
			</label>
		</div>
		<div id="rf">
			<h1 class="variable-name"></h1>
			<h2 class="variable-value"></h1>
			<label class="switch">
			  <input type="checkbox" name="rf" value="Present">
			  <span class="slider round"></span>
			</label>
		</div>
		<div id="ma">
			<h1 class="variable-name"></h1>
			<h2 class="variable-value"></h1>
			<label class="switch">
			  <input type="checkbox" name="ma" value="Present">
			  <span class="slider round"></span>
			</label>
		</div>
		<div id="tx">
			<h1 class="variable-name"></h1>
			<h2 class="variable-value"></h1>
			<label class="switch">
			  <input type="checkbox" name="tx" value="Present">
			  <span class="slider round"></span>
			</label>
		</div>

		<save-close>Save</save-close>
	</boolean-lightbox>

	<custom-calculator id="calculator">
		<toggle-view>
				<span id="gallery">Gallery</span>
				<span id="calc">Calculator</span>
		</toggle-view>
		<output-screen>
			<h1>Show Me</h1>
			<p id="output-message"><text id="default-message">Set some variables to start calculating!</text>
				<pl-value></pl-value>
				<sh-value></sh-value>
				<or-value></or-value>
				<co-value></co-value>
				<te-value></te-value>
				<va-value></va-value>
				<si-value></si-value>
				<po-value></po-value>
				<li-value></li-value>
				<ar-value></ar-value>
				<re-value></re-value>
				<sp-value></sp-value>
				<ki-value></ki-value>
				<rf-value></rf-value>
				<ma-value></ma-value>
				<tx-value></tx-value></p>
				<h1 id="output-count"></h1>
		</output-screen>
		<photo-collage></photo-collage>
		<buttons-module></buttons-module>
	</custom-calculator>



</body>


<!-- Script -->
<script>

window.onresize = function() {
	toggleView();
}

//Define global variables

var tracking;
var df;
var directory;

//Create custom HTML Elements
customElements.define('site-logo', class extends HTMLElement {
})

customElements.define('custom-calculator', class extends HTMLElement {
	constructor() { 
		super();
		this.attachShadow({mode:'open'}).innerHTML=`
  <style>
    :host {
    	display:inline-block;
    	background-color:#1A1A1A;
    	width:100%;
    	height:auto;
    }

    ::slotted( output-screen ){
    	z-index:0;
    	position:relative;
    	display:inline-block;
    	background-color:#EB2E2F;
    	width:50%;
    	height:85vh;
    }
    // ::slotted( photo-collage){
    // 	display:none;
    // 	overflow:hidden;
    // 	overflow-y:scroll;
    // 	padding-top:10vh;
    // }

    ::slotted( buttons-module ){
    	display:inline-block;
    	width: 49%;
    	height:100%;
    	vertical-align:top;
    }

    @media screen and (max-width:900px){
    	::slotted( output-screen ){
    	width:100%;
    	min-height:35vh;
    	height:auto;
    }

    ::slotted( photo-collage ){
    	width:100%;
    	min-height:100vh;
    	height:auto;
    }

    ::slotted( buttons-module ){
    	width:100%;
    	height:50vh;
    	padding-top:10%;
    }
    }

  </style>
  <slot></slot>
  `;
	};
})

customElements.define('output-screen', class extends HTMLElement {
})

customElements.define('buttons-module', class extends HTMLElement {
	constructor () {
		super();
		this.attachShadow({mode:"open"}).innerHTML = `
		<style>
		  ::slotted( calc-buttons ){
		  	display: inline-block;
	    	background-color: #F16E31;
	    	width:20%;
	    	margin:2.5%;
	    	font-size:3em;
	    	font-weight:600;
	    	text-transform:uppercase;
		  }
		  ::slotted( calc-buttons:hover ){
		  	background-color:white;
		  	color:#F16E31;
		  	transition: all 0.25s ease-in-out;
		  }
		
		 @media screen and (max-width:900px){
		 	::slotted( calc-buttons ){
		 		font-size:2em;
		 	}
		 	::slotted( calc-buttons:active ){
		  	background-color:white;
		  	color:#F16E31;
		  }

		 }
		</style>
		<slot></slot>
		`;
	}
})

customElements.define('calc-buttons', class extends HTMLElement {
})

customElements.define('bg-overlay', class extends HTMLElement {
	constructor() {
		super();
		this.attachShadow({mode:"open"}).innerHTML = `
		<style>
		:host {
			z-index:2;
			position:fixed;
			display:none;
			width:100%;
			height:100%;
			background-color:black;
			opacity:0.5;
		}
		</style>
		`;
	}
})

customElements.define('slider-lightbox', class extends HTMLElement {
	constructor() {
		super();
		this.attachShadow({mode:"open"}).innerHTML = `
		<style>
		:host {
			display:none;
			position:fixed;
			z-index:2;
			width:80%;
			margin: 5% 3% 5% 8%;
			height:50vh;
			background-color:black;
			overflow:hidden;
		}
		@media screen and (max-width:900px){
			:host {
				margin-top:0%;
				height:70vh;
			}
		}
		</style>
		<slot></slot>
		`;
	}
})

customElements.define('checkbox-lightbox', class extends HTMLElement {
	constructor() {
		super();
		this.attachShadow({mode:"open"}).innerHTML = `
		<style>
		:host {
			display:none;
			position:fixed;
			z-index:2;
			width:80%;
			margin: 5% 3% 5% 8%;
			height:50vh;
			background-color:black;
			overflow:hidden;
			color:white;
		}
		@media screen and (max-width:900px){
			:host {
				margin-top:0%;
				height:70vh;
			}
		}
		</style>
		<slot></slot>
		`;
	}
})

customElements.define('boolean-lightbox', class extends HTMLElement {
	constructor() {
		super();
		this.attachShadow({mode:"open"}).innerHTML = `
		<style>
		:host {
			display:none;
			position:fixed;
			z-index:2;
			width:80%;
			margin: 5% 3% 5% 8%;
			height:50vh;
			background-color:black;
			overflow:scroll;
			color:white;
		}
		::slotted( div ){
			display:inline-block;
			margin:5%;
		}
		@media screen and (max-width:900px){
			:host {
				margin-top:0%;
				height:70vh;
			}
		}
		</style>
		<slot></slot>
		`;
	}
})

customElements.define('close-cancel', class extends HTMLElement {
	constructor() {
		super();
		this.attachShadow({mode:"open"}).innerHTML = `
		<style>
		:host {
			border: 0.05em white solid;
			padding:1% 2%;
			margin-right:3%;
			margin-top:3%;
			font-size:0.8em;
			float:right;
			cursor:pointer;
			color:white;
		}
		:host(:hover){
			background-color: #EB2E2F;
			border: 0.05em #EB2E2F solid;
			transition: all 0.25s ease-in-out;
		}
		
		@media screen and (max-width:900px) {
			:host {
				margin-right:5%;
				margin-top:5%;
				padding:3% 4%;
				font-size:1em;
			}
			:host(:active){
			background-color: #EB2E2F;
			border: 0.05em #EB2E2F solid;
			}
		}
		</style>
		<slot></slot>
		`;
	}
})

customElements.define('save-close', class extends HTMLElement {
	constructor() {
		super();
		this.attachShadow({mode:"open"}).innerHTML = `
		<style>
		:host {
			position:absolute;
			right:0;
			bottom:0;
			font-size:2em;
			font-weight:100;
			padding:5%;
			color:white;
			cursor:pointer;
		}
		:host(:hover) {
			color:#EB2E2F;
			transition: all 0.25s ease-in-out;
		}
		@media screen and (max-width:900px) {
			:host(:active) {
			color:#EB2E2F;
			}
		}
		
		</style>
		<slot></slot>
		`;
	}
})

customElements.define('selected-variable', class extends HTMLElement {
	constructor(){
		super();
		this.attachShadow({mode:"open"}).innerHTML=`
		<style>
		:host {
			color:white;
			font-size:1em;
			float:left;
			width:30%;
			padding:2%;
		}
		</style>
		<slot></slot>
		`;
	}
})

customElements.define('slider-holder', class extends HTMLElement {
	constructor() {
		super();
		this.attachShadow({mode:"open"}).innerHTML = `
		<style>
		:host {
			display:inline-block;
			width:30%;
			height:100%;
			overflow-y:scroll;
		}
		::slotted(gradient-slider){
			display:inline-block;
			margin:auto;
			width:100%;
			height:300%;
			background:linear-gradient(#EB2E2F,#F99873);
		}
		@media screen and (max-width:900px) {
			:host {
				width:100%;
				height:30%;
				padding-top:30%;
				overflow-x:scroll;
				overflow-y:hidden;
			}
			::slotted( gradient-slider ){
				width:300%;
				height:100%;
				background:linear-gradient(to right, #EB2E2F, #F99873);
			}
		}
		</style>
		<slot></slot>
		`;
	}
})

customElements.define('gradient-slider', class extends HTMLElement {
});

customElements.define('clear-button', class extends HTMLElement {
	constructor() {
		super();
		this.attachShadow({mode:"open"}).innerHTML = `
		<style>
		:host {
			font-size:0.05em;
			background-color:#42210B;
			margin:1% 2%;
			padding:0.5% 2% 1% 1.5%;
			border-radius:1em;
			color:white;
			font-weight:700;
			vertical-align:middle;
			cursor:pointer;
		}
		:host(:hover) {
			background-color:white;
			color:#42210B;
			transition: all 0.25s ease-in-out;
		}
		@media screen and (max-width:900px){
			:host(:active) {
			background-color:white;
			color:#42210B;
			}
		}
		
		</style>
		<slot></slot>
		`;
	}
});

customElements.define('lightbox-slider', class extends HTMLElement {
	constructor(){
		super();
		this.attachShadow({mode:"open"}).innerHTML = `
		<style>
		:host {
			width:100%;
			left:0;
			top:0;
			height:100vh;
			background-color:black;
			display:none;
			position:fixed;
			z-index:3;
		}
		::slotted( img ){
			height:80%;
			margin-top:5%;
			margin-left:35%;
		}
		</style>
		<slot></slot>
		`;
	}
})

customElements.define('checkbox-holder', class extends HTMLElement {
	constructor() {
		super();
		this.attachShadow({mode:"open"}).innerHTML = `
		<style>
		:host {
			display:inline-block;
			width:30%;
			height:100%;
			padding-left:5%;
			padding-top:12.5%;
		}
		@media screen and (max-width:900px) {
			:host {
				width:100%;
				height:30%;
				padding-top:30%;
			}
		}
		</style>
		<slot></slot>
		`;
	}
})

customElements.define('photo-collage', class extends HTMLElement {
	constructor() {
		super();
		this.attachShadow({mode:"open"}).innerHTML = `
		<style>
		:host {
			display:none;
			position:relative;
	    	// display:inline-block;
	    	background-color:#EB2E2F;
	    	width:0%;
	    	height:85vh;
	    	line-height:0;
	    	overflow:hidden;
	    	overflow-y:scroll;
	    	padding-top:10vh;
		}
		</style>
		<slot></slot>
		`;
	}
})

customElements.define('img-holder', class extends HTMLElement {
	constructor() {
		super();
		this.attachShadow({mode:"open"}).innerHTML = `
		<style>
		:host {
			position:relative;
			display:inline-block;
			overflow:hidden;
			width:12.5%;
			height:auto;
			opacity:1;
		}
		:host(:hover){
			opacity:0.8;
		}
		::slotted( img ){
			position:relative;
			display:block;
			z-index:0;
			width:120%;
			height:100%;
			cursor:pointer;
		}
		::slotted( div ) {
			display:block;
			position:absolute;
			top: 0;
		  	bottom: 0;
		  	left: 0;
		  	right: 0;
			width:100%;
			height:100%;
			background-color:black;
			z-index:1;
			transition:0.25s ease-in-out;
		}
		::slotted( p ) {
			text-align:center;
			color:white;
		}
		@media screen and (max-width:900px){
			:host {
				width:25%;
			}
		}
		</style>
		<slot></slot>
		`;
	}
})

customElements.define('toggle-view', class extends HTMLElement {
	constructor() {
		super();
		this.attachShadow({mode:"open"}).innerHTML = `
		<style>
		:host {
			position:absolute;
			display:inline-block;
			width:50%;
			float:right;
			z-index:1;
			background-color:#EB2E2F;
		}
		::slotted( span ){
			color:#F16E31;
			display:inline;
			float:right;
			padding:5%;
			text-transform:uppercase;
			font-weight:700;
			letter-spacing:0.1em;
			font-size:0.8em;
			cursor:pointer;
			text-decoration:none;
			transition:0.25s ease-in-out;
		}
		::slotted( span:hover ){

			text-decoration:underline;
		}
		@media screen and (max-width:900px){
			:host {
				width:100%;
			}
		}
		</style>
		<slot></slot>
		`;
	}
})

customElements.define("mobile-instructions", class extends HTMLElement {
	constructor(){
		super();
		this.attachShadow({mode:"open"}).innerHTML=`
		<style>
		:host {
			display:inline-block;
			width:100%;
			height:100%;
			color:#CCCCCC;
			text-transform:uppercase;
		}
		::slotted( instructions-section ){
			display:block;
		}
		</style>
		<slot></slot>
		`;
	}
})

//Change arrow direction for mobile instructions
function getSliderInstructions(){
	var target = document.querySelector('instructions-section');
	if( window.innerWidth <= 900) {
		target.innerHTML="&larr; Swipe to set value &rarr;";
		target.addEventListener('touchstart',function() {
			target.style.display="none";
		})
	} else {
		target.innerHTML="&uarr; Swipe to set value &darr;";
		target.addEventListener("click", function() {
			target.style.display="none";
		})
	};
}

getSliderInstructions();

function positionInstructions() {
	var target = document.querySelector('instructions-section');
	targetHeight = parseFloat(window.getComputedStyle(target).height/2);
	console.log(targetHeight);
	target.style.marginTop = targetHeight;
}

// Create buttons for visual variables
data = [
	{"id": "pl", "type": "int", "hierarchy": 1},
	 {"id": "sh", "type": "int", "hierarchy": 1},
	 {"id": "or", "type": "int", "hierarchy": 1},
	 {"id": "co", "type": "int", "hierarchy": 1},
	 {"id": "te", "type": "int", "hierarchy": 1},
	 {"id": "va", "type": "int", "hierarchy": 1},
	 {"id": "si", "type": "int", "hierarchy": 1},
	 {"id": "po", "type": "ord", "hierarchy": 2},
	 {"id": "li", "type": "ord", "hierarchy": 2},
	 {"id": "ar", "type": "ord", "hierarchy": 2},
	 {"id": "re", "type": "ord", "hierarchy": 3},
	 {"id": "sp", "type": "ord", "hierarchy": 3},
	 {"id": "ki", "type": "bool", "hierarchy": 3},
	 {"id": "rf", "type": "bool", "hierarchy": 3},
	 {"id": "ma", "type": "bool", "hierarchy": 3},
	 {"id": "tx", "type": "bool", "hierarchy": 3},
	 //ord: 5- ext. strong, 3 - somewhat strong, 0-absence
	 // bool: 0, not present; 1: present
	 // int: 0,1,2,3,4,5
	 // {"id": "submit"}
]

for(i=0;i<data.length;i++) {
	label = data[i]["id"];
	customElements.define(label+'-value', class extends HTMLElement {
		constructor() {
			super();
			this.attachShadow({mode:"open"}).innerHTML = `
			<style>
			:host {
				display:block;
				line-height:1.5em;
				letter-spacing:0.02em;
			}
			</style>
			<slot></slot>
			`;
		}
	})
}

// Calc-buttons behavior
for(i=0;i<data.length;i++){
	hierarchy = data[i]["hierarchy"];
	id = data[i]["id"];
	if(hierarchy == 1){
		d3.select('buttons-module').selectAll("buttons-module")
			.data(data.filter(function (d) { return d.id === id;}))
			.enter()
			.append('calc-buttons')
			.attr("id", function(d) {return d.id})
			.style("cursor", "pointer")
			.text(function(d) {return d.id})
			.style("text-align", "center")
			.style("padding-top", "3%")
			.style("padding-bottom", "3%")
			.on("click", sliderOn)
			.exit()
	} else if (hierarchy == 2) {
		d3.select('buttons-module').selectAll("buttons-module")
			.data(data.filter(function (d) { return d.id === id;}))
			.enter()
			.append('calc-buttons')
			.attr("id", function(d) {return d.id})
			.style("cursor", "pointer")
			.style("background-color", "#F19368")
			.text(function(d) {return d.id})
			.style("text-align", "center")
			.style("padding-top", "3%")
			.style("padding-bottom", "3%")
			.on("click", checkboxOn)
			.exit()
	}
}

var other = document.createElement('calc-buttons');
other.innerHTML = "More Filters";
other.style.width = "45%";
other.style.fontSize = "1.3em";
other.style.paddingTop = "7%"
other.style.paddingBottom = "4%"
other.style.textAlign = "center";
other.style.backgroundColor = "#F1B59A";
other.id = "other-filters";

document.querySelector('buttons-module').appendChild(other);
other.addEventListener("click", function() {
	booleanOn();
})

function sliderOn() {
	document.querySelector('slider-lightbox').style.display="inline-block";
	document.querySelector('bg-overlay').style.display="block";
}

function checkboxOn() {
	document.querySelector('checkbox-lightbox').style.display="inline-block";
	document.querySelector('bg-overlay').style.display="block";
}

function booleanOn() {
	document.querySelector('boolean-lightbox').style.display="inline-block";
	document.querySelector('bg-overlay').style.display="block";
}
// When click on buttons, ID stores as value
var buttons = document.getElementsByTagName('calc-buttons');
for(i=0;i<buttons.length;i++) {
	buttons[i].onclick=function () {

		document.querySelector('html').style.position="fixed";
		tracking = this.id;

		if (tracking === "pl") {
			document.querySelector('.variable-name').textContent = 'Placement';
		} else if (tracking === "sh") {
			document.querySelector('.variable-name').textContent = 'Shape';
		} else if (tracking === "or") {
			document.querySelector('.variable-name').textContent = 'Orientation';
		} else if (tracking === "co") {
			document.querySelector('.variable-name').textContent = 'Color';
		} else if (tracking === "te") {
			document.querySelector('.variable-name').textContent = 'Texture';
		} else if (tracking === "va") {
			document.querySelector('.variable-name').textContent = 'Value';
		} else if (tracking === "si") {
			document.querySelector('.variable-name').textContent = 'Size';
		} else if (tracking === "po") {
			document.getElementsByClassName('variable-name')[1].textContent = 'Point';
		} else if (tracking === "li") {
			document.getElementsByClassName('variable-name')[1].textContent = 'Line';
		} else if (tracking === "ar") {
			document.getElementsByClassName('variable-name')[1].textContent = 'Area';
		} else if (tracking === "other-filters") {
			console.log("you clicked other filters!");
			document.getElementsByClassName('variable-name')[2].textContent = 'Representational';
			document.getElementsByClassName('variable-name')[3].textContent = 'Spatial';
			document.getElementsByClassName('variable-name')[4].textContent = 'Kinetic';
			document.getElementsByClassName('variable-name')[5].textContent = 'Reflection';
			document.getElementsByClassName('variable-name')[6].textContent = 'Map';
			document.getElementsByClassName('variable-name')[7].textContent = 'Has Text';
		}
	}
	positionInstructions();
}

// When click on close-cancel, don't save any output
var cancel = document.getElementsByTagName('close-cancel');
for (i=0;i<cancel.length;i++){
	cancel[i].onclick = function() {
		document.querySelector('html').style.position="relative";
		document.querySelector('slider-lightbox').style.display="none";
		document.querySelector('checkbox-lightbox').style.display="none";
		document.querySelector('boolean-lightbox').style.display="none";
		document.querySelector('bg-overlay').style.display="none";
	}
}

	

// When click on save and close, send values to output screen

var close = document.getElementsByTagName('save-close');
for (i=0;i<close.length;i++){
	
	
	close[i].onclick= function() {
		parentName = this.parentElement.nodeName;
		console.log(parentName);
		var parentID = document.querySelector(parentName);
		document.querySelector('html').style.position="relative";

		document.querySelector('slider-lightbox').style.display="none";
		document.querySelector('checkbox-lightbox').style.display="none";
		document.querySelector('boolean-lightbox').style.display="none";
		document.querySelector('bg-overlay').style.display="none";

		function fillOutput() {
			if(parentName != "BOOLEAN-LIGHTBOX") {
				var parentID = document.querySelector(parentName);
				document.querySelector("#default-message").textContent = "";
				var name = parentID.querySelector('.variable-name').innerHTML;
				document.querySelector(tracking+'-value').innerHTML =  "<h5>" + 
					parentID.querySelector('.variable-value').innerHTML + 
					"</h5> " + name + "<clear-button>x</clear-button>";
			} else if (parentName == "BOOLEAN-LIGHTBOX"){
				document.querySelector("#default-message").textContent = "";
				var boolean_lightbox = document.querySelector('boolean-lightbox');
				var names = boolean_lightbox.querySelectorAll('.variable-name');
				console.log(names.length);
				for(i=0;i<names.length;i++){
					parentName = names[i].parentElement.id;
					var parentID = document.getElementById(parentName);
					if( parentID.querySelector('.variable-value').innerHTML!= ""){
						name = names[i].innerHTML;
						document.querySelector(parentName+'-value').innerHTML =  "<h5>" + parentID.querySelector('.variable-value').innerHTML + "</h5> " + name + "<clear-button>x</clear-button>";
					} else {
						document.querySelector(parentName+'-value').innerHTML =  "";
					};
				}
			}
		};

		fillOutput();
		updateData();
	}
}


function updateData () {
	// Store saved values and return images

	directory = [];

	for(i=0;i<data.length;i++) {
		storedVarName = data[i]['id'];
		storedVarType = data[i]['type']
		ref = document.querySelector(storedVarName+'-value');

		if(ref.innerHTML!= "") {
			storedVarVal = ref.querySelector('h5').innerHTML;
			if (storedVarType == "int") {
				if (storedVarVal === "Extremely Strong") {
				storedVarVal = 5;
				} else if(storedVarVal === "Very Strong") {
					storedVarVal = 4;
				} else if (storedVarVal === "Somewhat Strong") {
					storedVarVal = 3;
				} else if (storedVarVal === "Slightly Weak") {
					storedVarVal = 2;
				} else if (storedVarVal === "Somewhat Weak") {
					storedVarVal = 1;
				}
			} else if (storedVarType == "ord") {
				if (storedVarVal === "Extremely Strong") {
				storedVarVal = 5;
				} else if (storedVarVal === "Somewhat Strong") {
					storedVarVal = 3;
				} else if (storedVarVal === "None") {
					storedVarVal = 0;
				}
			} else if (storedVarType == "bool") {
				if (storedVarVal === "Present") {
				storedVarVal = true;
				} else if (storedVarVal != "Present") {
					storedVarVal = false;
				} 
			}
			
			// console.log(storedVarName+": "+storedVarVal);
			directory.push({
				key: storedVarName,
				value: storedVarVal
			});
		} else {
			continue;
		}
	}
	console.log(directory);

	// Get the data
	json_path = 'https://raw.githubusercontent.com/3milychu/visuncertainty/master/data/data.json'
	var xttp = new XMLHttpRequest();
	xttp.open("GET", json_path, true);
	xttp.send();
	xttp.onreadystatechange = function() {
		if(this.readyState == 4 && this.status == 200) {

			df = JSON.parse(this.responseText);
			// console.log(df);

				// Filter data by selected variables
				df = df.filter(function(obj) {
				    return directory.reduce(function(a, f) {
				        return a && (obj[f.key] === f.value);
				    }, true);
				});
				// console.log(df.length);
				console.log(df);
				document.querySelector('#output-count').innerHTML = df.length + " Images";

				//Populate photo collage
				d3.select("photo-collage").selectAll("img-holder").remove();
				d3.select("photo-collage").selectAll('photo-collage')
					.data(df)
					.enter()
					.append("img-holder")
					.style("cursor", "pointer")
					.attr("class", function(d) {return "number"+d.s_no;})
					.attr("id", function(d) {return "number"+d.s_no;})
					.append("img")
					.attr("class", "image")
					.attr("src", function(d) 
						{return "http://visualizeuncertainty.io/img_cropped/" + d.s_no + ".jpg";})
					.exit()

				var min=d3.min(df, function(d) {return d.s_no;});
				var max=d3.max(df, function(d) {return d.s_no;});
				console.log(min,max);
				for(i=min;i<max;i++){
					tracker = i;
					d3.select(".number"+[i]).selectAll("div").remove();
					d3.select(".number"+[i]).selectAll("#number"+[i])
					.data(df.filter(function(d,i) { return d.s_no == tracker;}))
					.enter()
					.append("div")
					.attr("class","overlay")
					.append("p")
					.html(function(d) {return "<p>"+d.title +"<br><br>"+ d.artist+"</p>";})
					.exit();
				}

				}
		}

}

// When click on clear, clear content inside parent element
document.body.addEventListener("click", function () {
	var clearButtons = document.getElementsByTagName('clear-button');
	for (i=0;i<clearButtons.length;i++){
		clearButtons[i].onclick=function() {
			parentID = this.parentElement.nodeName;
			document.querySelector(parentID).innerHTML="";
			updateData();
		}
	}

})

// Slider bins
var slider = document.querySelector('slider-holder');
var gradient = document.querySelector('gradient-slider');
slider.onscroll = function () {

	if( window.innerWidth <= 900) {
		// console.log(this.scrollLeft)
		value = this.scrollLeft;
		maxValue = 600;
		binSize = maxValue/5
		if (value < binSize){
			document.querySelector('.variable-value').textContent = 'Extremely Strong';
		} else if (value > binSize & value < binSize*2){
			document.querySelector('.variable-value').textContent = 'Very Strong';
		} else if (value > binSize*2 & value < binSize*3){
			document.querySelector('.variable-value').textContent = 'Somewhat Strong';
		} else if (value > binSize*3 & value < binSize*4){
			document.querySelector('.variable-value').textContent = 'Slightly Weak';
		} else if (value > binSize*4 & value < binSize*5){
			document.querySelector('.variable-value').textContent = 'Somewhat Weak';
		};
	} else {
		value = this.scrollTop;
		maxValue = 477;
		binSize = maxValue/5
		if (value < binSize){
			document.querySelector('.variable-value').textContent = 'Extremely Strong';
		} else if (value > binSize & value < binSize*2){
			document.querySelector('.variable-value').textContent = 'Very Strong';
		} else if (value > binSize*2 & value < binSize*3){
			document.querySelector('.variable-value').textContent = 'Somewhat Strong';
		} else if (value > binSize*3 & value < binSize*4){
			document.querySelector('.variable-value').textContent = 'Slightly Weak';
		} else if (value > binSize*4 & value < binSize*5){
			document.querySelector('.variable-value').textContent = 'Somewhat Weak';
		};
	}
}

// Checkbox-lightbox filters
var checkbox_lightbox = document.querySelector('checkbox-lightbox');
var radios = checkbox_lightbox.getElementsByTagName('input');
for (i=0;i<radios.length;i++){
	radios[i].onclick = function() {
		var checkedValue = document.querySelector('input[name="ordinal"]:checked').value;
		console.log(checkedValue);
		// parentID = this.parentElement.nodeName;
		// console.log(parentID);
		document.getElementsByClassName('variable-value')[1].textContent = checkedValue;
	}
}

// Boolean0lightbox filters
var boolean_lightbox = document.querySelector('boolean-lightbox');
var filters = boolean_lightbox.getElementsByTagName('input');
for (i=0;i<filters.length;i++){
	filters[i].onclick=function() {
		parentID = this.parentElement.id;
		console.log(parentID);
		var target = document.getElementById(parentID);
		type = this.type;
		checked = this.checked;
		value = this.value;
		name = this.name;
		console.log(type);
		if (type == "radio") {
			var selectionValue = target.querySelector('input:checked').value;
			target.querySelector('.variable-value').innerHTML = selectionValue;
		} else if (type =="checkbox" && checked == true && name == "ki") {
			parentID = "ki";
			var target = document.getElementById(parentID);
			target.querySelector('.variable-value').innerHTML = value;
		} else if (type =="checkbox" && checked == true && name == "rf") {
			parentID = "rf";
			var target = document.getElementById(parentID);
			target.querySelector('.variable-value').innerHTML = value;
		} else if (type =="checkbox" && checked == true && name == "ma"){
			parentID = "ma";
			var target = document.getElementById(parentID);
			target.querySelector('.variable-value').innerHTML = value;
		} else if (type =="checkbox" && checked == true && name == "tx") {
			parentID = "tx";
			var target = document.getElementById(parentID);
			target.querySelector('.variable-value').innerHTML = value;
		} else if (type =="checkbox" && checked == false && name == "ki"){
			parentID = "ki";
			var target = document.getElementById(parentID);
			target.querySelector('.variable-value').innerHTML = "";
		} else if (type =="checkbox" && checked == false && name == "rf") {
			parentID = "rf";
			var target = document.getElementById(parentID);
			target.querySelector('.variable-value').innerHTML = "";
		} else if (type =="checkbox" && checked == false && name == "ma") {
			parentID = "ma";
			var target = document.getElementById(parentID);
			target.querySelector('.variable-value').innerHTML = "";
		} else if (type =="checkbox" && checked == false && name == "tx") {
			parentID = "tx";
			var target = document.getElementById(parentID);
			target.querySelector('.variable-value').innerHTML = "";
		}
	}
}

// When click on an image, pop up the image in lightbox-slider

function loadLightbox() {

	var collage = document.querySelector('photo-collage');
	var lightbox = document.querySelector('lightbox-slider');
	var clickableImages = collage.getElementsByTagName('img');
	console.log(clickableImages);

	document.body.addEventListener("click", function () {
		for(i=0;i<clickableImages.length;i++) {
			clickableImages[i].addEventListener("click", function() {

				console.log("this works!");
				lightbox.innerHTML = "";
				lightbox.style.display="block";
				var elem = document.createElement('img');
				elem.id = this.id;
				elem.src = this.src;
				document.querySelector('lightbox-slider').appendChild(elem);

			})
		}
	})

}

// 

function toggleView() {

	var span_calc = document.querySelector('#calc');
	var span_gallery = document.querySelector('#gallery');
	var output_screen = document.querySelector('output-screen');
	var collage = document.querySelector('photo-collage');
	var buttons_module = document.querySelector('buttons-module');
	var toggle = document.querySelector('toggle-view');
	var toggle_list = document.querySelectorAll('span');
	var img_holders = document.querySelectorAll('img-holder');
	var output_count = document.querySelector('#output-count');

	function update() {
		condition = window.getComputedStyle(output_screen, null).getPropertyValue("display");
		console.log(condition);
		if(condition == "inline-block") {
		console.log("Calculator view")
		span_calc.style.color = "#FFF";
		span_gallery.style.color = "#F16E31";
		} else {
			span_calc.style.color = "#F16E31";
			span_gallery.style.color = "#FFF";
		}
	}

	update();

	if( window.innerWidth <= 900) {

		span_calc.addEventListener("click", function() {
			output_screen.style.display = "inline-block";
			output_screen.style.width = "100%";
			collage.style.display = "none";
			collage.style.width = "0%";
			buttons_module.style.display ="inline-block";
			toggle.style.width = "100%";		
			update();
		})

		span_gallery.addEventListener("click", function() {
			output_screen.style.width = "0%";
			output_screen.style.display = "none";
			collage.style.display = "inline-block";
			collage.style.width = "100%";
			buttons_module.style.display ="none";
			toggle.style.width = "100%";
			update();
		});

		output_count.addEventListener("click", function() {
			output_screen.style.width = "0%";
			output_screen.style.display = "none";
			collage.style.display = "inline-block";
			collage.style.width = "100%";
			buttons_module.style.display ="none";
			toggle.style.width = "100%";	
			update();
		});

	} else {

		span_calc.addEventListener("click", function() {
			output_screen.style.display = "inline-block";
			output_screen.style.width = "50%";
			collage.style.display = "none";
			collage.style.width = "0%";
			buttons_module.style.display="inline-block";
			toggle.style.width = "50%";
			for(i=0;i<toggle_list.length;i++){
				toggle_list[i].style.padding = "5%";
			}
			update();
		})

		span_gallery.addEventListener("click", function() {
			output_screen.style.width = "0%";
			output_screen.style.display = "none";
			collage.style.display = "inline-block";
			collage.style.width = "100%";
			buttons_module.style.display="none";
			toggle.style.width = "100%";
			for(i=0;i<toggle_list.length;i++){
				toggle_list[i].style.padding = "3%";
			}
			update();
		});

		output_count.addEventListener("click", function() {
			output_screen.style.width = "0%";
			output_screen.style.display = "none";
			collage.style.display = "inline-block";
			collage.style.width = "100%";
			buttons_module.style.display ="none";
			toggle.style.width = "100%";
			for(i=0;i<toggle_list.length;i++){
				toggle_list[i].style.padding = "3%";
			}			
			update();
		});

	};

};

toggleView();


</script>


</html>